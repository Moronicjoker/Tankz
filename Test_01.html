<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title></title>
        <script src="three.js" type="text/javascript"></script>

    
        <script>
        <!--

      
            var camera, scene, renderer;
            
            var loader = new THREE.JSONLoader();

            var clock = new THREE.Clock();

            var groupHead;

            var renderReady = 0;

            var mesh = null;

            var index = 0;

            var mouseX = 0, mouseY = 0;

            document.addEventListener("DOMContentLoaded",function(){

                 init();

                 loadModel();
                        
            },false);


            document.addEventListener("mousemove",function(event){


                mouseX = ( event.clientX - window.innerWidth / 2 );
                mouseY = ( event.clientY - window.innerHeight / 2 );

                    //mesh.position.z = mouseX * 0.1;

                    mesh.rotation.y = mouseX * 0.01;


            },false);

            document.addEventListener("mousedown",function(event){
                index=0;document.getElementById("wtf").innerHTML = "camera";
            },false);

            
            function init() {
                /**************************************************************
                    Basic Scene Setup
                **************************************************************/
                camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 10000 );
                camera.position.z = 300;

                scene = new THREE.Scene();


                renderer = new THREE.WebGLRenderer({antialias: true});
                renderer.setSize( window.innerWidth, window.innerHeight );
                renderer.setClearColor(0x222222, 0.6)
                document.body.appendChild( renderer.domElement );

                // add subtle blue ambient lighting
                var ambientLight = new THREE.AmbientLight(0x000000);
                scene.add(ambientLight);
                  
                // directional lighting
                var directionalLight = new THREE.DirectionalLight(0xffffff);
                directionalLight.position.set(0, 0, 1).normalize();
                scene.add(directionalLight);
                

                // directional lighting
                var directionalLight = new THREE.DirectionalLight(0x00ff00);
                directionalLight.position.set(2, 2, -5).normalize();
                scene.add(directionalLight);

            
                renderer.render( scene, camera );                

            };   
            
           function loadModel(){

                groupHead = new THREE.Object3D();

                loader.load( 'test.js', function ( geometry, materials ) {

                    createScene( geometry, materials, 0, 0, -300, 60 )

                });


           }; // END loadModel
      

            function renderOLD() {


        var delta = clock.getDelta();
        



        // and render the scene
        renderer.render(scene, camera);


        // render using requestAnimationFrame
        requestAnimationFrame(render);


        }


            function render() {

                //var delta = 0.75 * clock.getDelta();
                //var delta =  clock.getDelta();

                /*
                if( index == 0 ) {

                    camera.position.x += ( mouseX - camera.position.x ) * .05;
                    camera.position.y = THREE.Math.clamp( camera.position.y + ( - mouseY - camera.position.y ) * .05, 0, 1000 );

                    camera.lookAt( scene.position );
                    
                }
                */

                // update skinning

                //THREE.AnimationHandler.update( delta );

                //if ( helper !== undefined ) helper.update();


                renderer.render( scene, camera );

                requestAnimationFrame(render);

            }



            var currentAnimationTime = 0;

        function showKeyCode(e) {
            var pressedKey = e.keyCode ;

            console.log(pressedKey)

            if(pressedKey == 49){index=0;document.getElementById("wtf").innerHTML = "camera";};
            if(pressedKey == 50){index=1;document.getElementById("wtf").innerHTML = "ridge";};
            if(pressedKey == 51){index=2;document.getElementById("wtf").innerHTML = "spikes";};
            if(pressedKey == 52){animation.play()};
            if(pressedKey == 53){currentAnimationTime = animation.currentTime;animation.stop();console.log( 'stop: ', currentAnimationTime );};
            if(pressedKey == 54){
                animation.play( currentAnimationTime );

            };
            if(pressedKey == 55){index=3;document.getElementById("wtf").innerHTML = "breath";};
            if(pressedKey == 56){index=4;document.getElementById("wtf").innerHTML = "scrub";animation.stop();};
            if(pressedKey == 57){
                document.getElementById("wtf").innerHTML = "playing pt. 1";
                animation.play();
                console.log('animation.data.length: ',animation.data.length);
                stopTimeout = setTimeout( function() {
                    animation.stop();
                    stopTimeout = null;
                }, animation.data.length / 2.0 * 1000 );
            };
            if(pressedKey == 48){
                document.getElementById("wtf").innerHTML = "playing pt. 2";
                animation.play( animation.data.length / 2.0 );
                stopTimeout = setTimeout( function() {
                    animation.stop();
                    stopTimeout = null;
                }, animation.data.length / 2.0 * 1000 );
            };
        }; // END showKeyCode

            function ensureLoop( animation ) {

                for ( var i = 0; i < animation.hierarchy.length; i ++ ) {

                    var bone = animation.hierarchy[ i ];

                    var first = bone.keys[ 0 ];
                    var last = bone.keys[ bone.keys.length - 1 ];

                    last.pos = first.pos;
                    last.rot = first.rot;
                    last.scl = first.scl;

                }

            }

            function createScene( geometry, materials, x, y, z, s ) {

                //ensureLoop( geometry.animations[0] );

                /*
                geometry.computeBoundingBox();
                bb = geometry.boundingBox;

                console.log('materials.length: ',materials.length);

                for ( var i = 0; i < materials.length; i ++ ) {

                    var m = materials[ i ];
                    m.skinning = true;
                    m.morphTargets = true;

                    m.color.setHSL( 0.6, 0, 0.6 );
                    m.ambient.copy( m.color );

                    m.combine = THREE.MixOperation;
                    m.reflectivity = 0.75;
                

                    m.wrapAround = true;

                }

                console.log('1 end of materials loop');

                //mesh = new THREE.SkinnedMesh( geometry, new THREE.MeshFaceMaterial( materials ) );
                //mesh.position.set( x, y - bb.min.y * s, z );
                
                */

                //var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );

                mesh = new THREE.Mesh( geometry, new THREE.MeshFaceMaterial( materials ) ); 

                //mesh.rotation.set( 0, 90, 0 );
                mesh.scale.set( s, s, s );
                scene.add( mesh );





                console.log('2 mesh added to scene');

                mesh.castShadow = true;
                mesh.receiveShadow = true;

                console.log('2 mesh added to scene');

                render();

            }


        -->
        </script>



    </head>

    <body onkeydown="showKeyCode(event);">

        <div  style="position:absolute;top:20px;left:20px;color:white;">
        in Firefox press key and move mouse left to right: <br>
        "1" camera <br>
        "2" ridge shape key <br>
        "3" spikes shape key <br>
        "4" play complete animation <br>
        "5" pause animation <br>
        "6" continue animation <br>
        "7" breath shape key <br>
        "8" scrub through animation <br>
        "9" play animation part 1 <br>
        "0" play animation part 2 <br>

        </div>

        <div id="wtf" style="position:absolute;bottom:20px;left:20px;color:red">camera</div>

        <!--button type="button" onmousedown="render()" style="position:absolute;top:20px;left:20px;" >render</button>
        <button type="button" onmousedown="animation.play();" style="position:absolute;top:50px;left:20px;" >play animation</button-->


    </body>
</html>
